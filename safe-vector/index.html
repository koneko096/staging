<!DOCTYPE html>











<html lang="en-us">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>Work Safely with C&#43;&#43; Vector - Postmortem</title>

  
  
  <meta name="description" content="One of the notable feature of C&#43;&#43; (also C# and Obj-C) is operator overloading. In C&#43;&#43; vector, element can be accessed use &ldquo;[]&rdquo; bracket operator. Sounds good just like we accessing ordinary array." />
  <meta name="author" content="koneko096" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://koneko096.github.io/staging/app.min.css" />

  
  <link rel="preload stylesheet" as="style" href="https://koneko096.github.io/staging/an-old-hope.min.css" />
  <script
    defer
    src="https://koneko096.github.io/staging/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  <link rel="preload" as="image" href="https://koneko096.github.io/staging/theme.png" />

  

  
  <link rel="icon" href="https://koneko096.github.io/staging/favicon.ico" />
  <link rel="apple-touch-icon" href="https://koneko096.github.io/staging/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.66.0" />

  
  

  
  
  
  
  
  
  
  <meta property="og:title" content="Work Safely with C&#43;&#43; Vector" />
<meta property="og:description" content="One of the notable feature of C&#43;&#43; (also C# and Obj-C) is operator overloading. In C&#43;&#43; vector, element can be accessed use &ldquo;[]&rdquo; bracket operator. Sounds good just like we accessing ordinary array." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://koneko096.github.io/staging/safe-vector/" />
<meta property="article:published_time" content="2018-12-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-12-16T00:00:00+00:00" />

  
  <meta itemprop="name" content="Work Safely with C&#43;&#43; Vector">
<meta itemprop="description" content="One of the notable feature of C&#43;&#43; (also C# and Obj-C) is operator overloading. In C&#43;&#43; vector, element can be accessed use &ldquo;[]&rdquo; bracket operator. Sounds good just like we accessing ordinary array.">
<meta itemprop="datePublished" content="2018-12-16T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-12-16T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="188">



<meta itemprop="keywords" content="debug,error handling," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Work Safely with C&#43;&#43; Vector"/>
<meta name="twitter:description" content="One of the notable feature of C&#43;&#43; (also C# and Obj-C) is operator overloading. In C&#43;&#43; vector, element can be accessed use &ldquo;[]&rdquo; bracket operator. Sounds good just like we accessing ordinary array."/>

  
  
</head>


  <body class="not-ready" data-menu="true">
    <header class="header">
  
  <p class="logo">
    <a class="site-name" href="https://koneko096.github.io/staging">Postmortem</a><a class="btn-dark"></a>
  </p>
  

  <script>
    let bodyClx = document.body.classList;
    let btnDark = document.querySelector('.btn-dark');
    let sysDark = window.matchMedia('(prefers-color-scheme: dark)');
    let darkVal = localStorage.getItem('dark');

    let setDark = (isDark) => {
      bodyClx[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark ? 'yes' : 'no');
    };

    setDark(darkVal ? darkVal === 'yes' : sysDark.matches);
    requestAnimationFrame(() => bodyClx.remove('not-ready'));

    btnDark.addEventListener('click', () => setDark(!bodyClx.contains('dark')));
    sysDark.addEventListener('change', (event) => setDark(event.matches));
  </script>

  
  
  <nav class="menu">
    
    <a class="" href="https://koneko096.github.io/staging/categories">Categories</a>
    
    <a class="" href="https://koneko096.github.io/staging/faq/">FAQ</a>
    
  </nav>
  

  
</header>


    <main class="main">

<article class="post-single">
  <header class="post-title">
    <aside>
      <time>December 16, 2018</time>
      
      <span>koneko096</span>
      
    </aside>
    <h1>Work Safely with C&#43;&#43; Vector</h1>
  </header>
  <section class="post-content"><p>One of the notable feature of C++ (also C# and Obj-C) is operator overloading. In C++ vector, element can be accessed use &ldquo;[]&rdquo; bracket operator. Sounds good just like we accessing ordinary array. But there are problems with it. As the original behavior of array, accessing index out of allocated size will cause undefined behavior. Vector just doing so by preserving this behavior to the operator.</p>
<figure>
    <img src="https://i.redd.it/wzr2x3zklg211.png"/> 
</figure>

<p>This design is leveraging explicit checking everytime before element access performed. This done pretty well to prevent <a href="http://wiki.c2.com/?LeakyAbstraction">leaky abstraction</a>. But debugging will be hard because of generic error. In my case, I had to deal with CUDA kernel allocation too, so this kind of error message could not help at all.</p>
<p>Fortunately, std vector come with different method to get out of bound error. Instead of bracket operator, we can rely on <em>at</em> method. This way error handling become much easier. Here&rsquo;s an example.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdexcept&gt;    // out_of_range</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> v(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0</span>);
    <span style="color:#66d9ef">try</span> {
        v.at(<span style="color:#ae81ff">15</span>);
    }
    <span style="color:#66d9ef">catch</span> (<span style="color:#66d9ef">const</span> out_of_range<span style="color:#f92672">&amp;</span> e) {
        cerr <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Error while access vector: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> e.what() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div>
</section>

  
  
  <footer class="post-tags">
     
    <a href="https://koneko096.github.io/staging/tags/debug">debug</a>
     
    <a href="https://koneko096.github.io/staging/tags/error-handling">error handling</a>
    
  </footer>
  

  
  
  

  
  
</article>

</main>

    <footer class="footer">
  <p>&copy; 2021 <a href="https://koneko096.github.io/staging">Postmortem</a></p>
  <p>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</p>
  <p>
    <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper 5.0</a>
  </p>
</footer>

  </body>
</html>
